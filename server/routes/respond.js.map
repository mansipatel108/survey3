{"version":3,"sources":["routes/respond.ts"],"names":[],"mappings":";AAAA,IAAO,OAAO,WAAW,SAAS,CAAC,CAAC;AACpC,IAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC,cAAc,EAAE,UAAU,CAAC,CAAC;AAE/D,IAAI,MAAM,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC;AAO9B,IAAO,WAAW,WAAW,kBAAkB,CAAC,CAAC;AACjD,IAAO,MAAM,GAAG,WAAW,CAAC,MAAM,CAAC;AAEnC,IAAO,iBAAiB,WAAW,wBAAwB,CAAC,CAAC;AAC7D,IAAO,YAAY,GAAG,iBAAiB,CAAC,YAAY,CAAC;AACrD,IAAI,UAAU,EAAC,WAAW,CAAC;AAG3B,qBAAqB,GAAG,EAAE,GAAG,EAAE,IAAI;IAC/B,iCAAiC;IACjC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,eAAe,EAAE,CAAC,CAAC,CAAC;QACzB,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IAClC,CAAC;IACD,IAAI,EAAE,CAAC;AACX,CAAC;AAED,uCAAuC;AACvC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI;IACnC,MAAM,CAAC,IAAI,CAAC,UAAS,GAAG,EAAE,OAAO;QAC7B,EAAE,CAAC,CAAC,GAAG,CAAC,CACR,CAAC;YACG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,CAAC;QACD,IAAI,CACJ,CAAC;YACI,WAAW,GAAG,OAAO,CAAC;YACvB,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE;gBAChB,KAAK,EAAE,WAAW;gBAClB,WAAW,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,EAAE;gBACjD,OAAO,EAAE,OAAO;aACnB,CAAC,CAAC;QAEP,CAAC;IACL,CAAC,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AAEH,2BAA2B;AAC1B,MAAM,CAAC,GAAG,CAAC,iBAAiB,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI;IACjD,IAAI,EAAE,GAAG,GAAG,CAAC,MAAM,CAAC,EAAE,CAAC;IACvB,MAAM,CAAC,QAAQ,CAAC,EAAE,EAAE,UAAS,GAAG,EAAE,MAAM;QACpC,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACN,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,CAAC;QACD,IAAI,CAAC,CAAC;YACF,GAAG,CAAC,MAAM,CAAC,uBAAuB,EAAE;gBAChC,KAAK,EAAE,aAAa;gBACpB,WAAW,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,EAAE;gBACjD,MAAM,EAAE,MAAM;aACjB,CAAC,CAAC;YACH,UAAU,GAAG,MAAM,CAAC,CAAC,wBAAwB;QACjD,CAAC;IACL,CAAC,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AACJ,wBAAwB;AACvB,MAAM,CAAC,IAAI,CAAC,iBAAiB,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI;IACnD,sDAAsD;IACtD,EAAE,CAAC,CAAC,UAAU,CAAC,QAAQ,IAAI,IAAI,CAAC,CAChC,CAAC;QACE,YAAY,CAAC,MAAM,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE,EAAE,EAAC,UAAS,GAAG;YACxD,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;gBACN,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;gBACjB,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,CAAC;YACD,IAAI,CACJ,CAAC;gBACG,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;gBACpC,UAAU,CAAC,QAAQ,GAAG,KAAK,CAAC,CAAC,6BAA6B;gBAC1D,UAAU,CAAC,IAAI,CAAC,UAAU,GAAG;oBACzB,EAAE,CAAC,CAAC,GAAG,CAAC;wBAAC,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;oBAC3B,IAAI;wBAAC,OAAO,CAAC,GAAG,CAAC,0BAA0B,CAAC,CAAC;gBACjD,CAAC,CAAC,CAAC;YACP,CAAC;QACL,CAAC,CAAC,CAAC;IACN,CAAC;IACD,IAAI,YAAY,GAAG,EAAE,CAAC;IACtB,IAAI,YAAY,GAAG,EAAE,CAAC;IACtB,IAAI,YAAY,GAAG,EAAE,CAAC;IACtB,IAAI,YAAY,GAAG,EAAE,CAAC;IACtB,IAAI,YAAY,GAAG,EAAE,CAAC;IAEvB,kGAAkG;IAClG,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtD,YAAY,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAA;IAChD,CAAC;IACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtD,YAAY,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAA;IAChD,CAAC;IACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtD,YAAY,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAA;IAChD,CAAC;IACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtD,YAAY,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAA;IAChD,CAAC;IACD,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,YAAY,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;QACtD,YAAY,CAAC,IAAI,CAAC,EAAE,QAAQ,EAAE,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAA;IAChD,CAAC;IAED,uBAAuB;IACvB,YAAY,CAAC,MAAM,CAAC;QAChB,QAAQ,EAAE,GAAG,CAAC,MAAM,CAAC,EAAE;QACvB,YAAY,EAAE,YAAY;QAC1B,YAAY,EAAE,YAAY;QAC1B,YAAY,EAAE,YAAY;QAC1B,YAAY,EAAE,YAAY;QAC1B,YAAY,EAAE,YAAY;QAC1B,YAAY,EAAE,IAAI,CAAC,GAAG,EAAE;KAC3B,EAAE,UAAS,GAAG,EAAE,MAAM;QACnB,EAAE,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;YACN,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;YACjB,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,CAAC;QACD,IAAI,CAAC,CAAC;YACF,GAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAA,kBAAkB;QACxC,CAAC;IACL,CAAC,CAAC,CAAC;AACN,CAAC,CAAC,CAAC;AAIH,MAAM,CAAC,GAAG,CAAC,wBAAwB,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI;IACzD,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE;QAChB,KAAK,EAAE,WAAW;QAClB,WAAW,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,EAAE;QACjD,OAAO,EAAE,WAAW;KACvB,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AAGJ,2BAA2B;AAC3B,MAAM,CAAC,GAAG,CAAC,aAAa,EAAE,WAAW,EAAE,UAAC,GAAoB,EAAE,GAAqB,EAAE,IAAS;IAC5F,GAAG,CAAC,MAAM,CAAC,mBAAmB,EAAE;QAC5B,KAAK,EAAE,gBAAgB;QACvB,WAAW,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,EAAE;QACjD,QAAQ,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,EAAE;KAC9C,CAAC,CAAC;AACL,CAAC,CAAC,CAAC;AACH,MAAM;AACN,MAAM,CAAC,GAAG,CAAC,oBAAoB,EAAE,WAAW,EAAE,UAAC,GAAoB,EAAE,GAAqB,EAAE,IAAS;IACjG,GAAG,CAAC,MAAM,CAAC,mBAAmB,EAAE;QAC5B,KAAK,EAAE,gBAAgB;QACvB,WAAW,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,EAAE;QACjD,QAAQ,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,GAAG,EAAE;KAC9C,CAAC,CAAC;AACP,CAAC,CAAC,CAAC;AACH,wBAAwB;AACxB,MAAM,CAAC,GAAG,CAAC,QAAQ,EAAE,UAAU,GAAG,EAAE,GAAG,EAAE,IAAI;IACzC,EAAE,CAAC,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC;QACZ,GAAG,CAAC,MAAM,CAAC,OAAO,EAAE;YAChB,KAAK,EAAE,OAAO;YACd,QAAQ,EAAE,GAAG,CAAC,KAAK,CAAC,cAAc,CAAC;YACnC,WAAW,EAAE,GAAG,CAAC,IAAI,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,GAAG,EAAE;SACpD,CAAC,CAAC;IACP,CAAC;IACD,IAAI,CAAC,CAAC;QACF,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,aAAa,CAAC,CAAA,CAAA,qCAAqC;IAC3E,CAAC;AACL,CAAC,CAAC,CAAC;AAIH,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC","file":"routes/respond.js","sourcesContent":["import express = require('express');\r\nvar sendgrid = require('sendgrid')('ACCOUNT_NAME', 'PASSWORD');\r\nimport passport = require('passport');\r\nvar router = express.Router();\r\n\r\n// db references\r\nimport mongoose = require('mongoose');\r\nimport userModel = require('../models/user');\r\nimport User = userModel.User;\r\n\r\nimport surveyModel = require('../models/survey');\r\nimport Survey = surveyModel.Survey;\r\n\r\nimport surveyAnswerModel = require('../models/surveyanswer');\r\nimport SurveyAnswer = surveyAnswerModel.SurveyAnswer;\r\nvar tempSurvey,tempSurveys;\r\n\r\n\r\nfunction requireAuth(req, res, next) {\r\n    // check if the user is logged in\r\n    if (!req.isAuthenticated()) {\r\n        return res.redirect('/login');\r\n    }\r\n    next();\r\n}\r\n\r\n// Get Home page and render survey list\r\nrouter.get('/', function(req, res, next) {    \r\n    Survey.find(function(err, surveys) {\r\n        if (err) \r\n        {\r\n            console.log(err);\r\n            res.end(err);\r\n        }\r\n        else\r\n        {                \r\n             tempSurveys = surveys;\r\n            res.render('index', {\r\n                title: 'MS Survey',\r\n                displayName: req.user ? req.user.displayName : '',\r\n                surveys: surveys              \r\n            });\r\n            \r\n        }\r\n    });\r\n});\r\n\r\n//render respondSurvey page\r\n router.get('/takeSurvey/:id', function(req, res, next) {\r\n     var id = req.params.id;\r\n     Survey.findById(id, function(err, Survey) {\r\n         if (err) {\r\n             console.log(err);\r\n             res.end(err);\r\n         }\r\n         else {            \r\n             res.render('surveys/respondSurvey', {\r\n                 title: \"Take Survey\",\r\n                 displayName: req.user ? req.user.displayName : '',\r\n                 survey: Survey,               \r\n             });\r\n             tempSurvey = Survey; //take the survey object\r\n         }\r\n     }); \r\n });\r\n// submit survey answers\r\n router.post('/takeSurvey/:id', function (req, res, next) {\r\n     //if survey has been modified , delete all the answer \r\n     if (tempSurvey.modified == true)\r\n     {\r\n        SurveyAnswer.remove({ surveyId: req.params.id },function(err){\r\n            if (err) {\r\n                console.log(err);\r\n                res.end(err);\r\n            }\r\n            else\r\n            {\r\n                console.log(\"successfully removed\");\r\n                tempSurvey.modified = false; // bring status back to false\r\n                tempSurvey.save(function (err) {  // save to db\r\n                    if (err) return Error(err); \r\n                    else console.log(\"modified status changed!\");\r\n                });\r\n            }\r\n        });\r\n     }\r\n     var shorAns1Arry = [];\r\n     var shorAns2Arry = [];\r\n     var shorAns3Arry = [];\r\n     var shorAns4Arry = [];\r\n     var shorAns5Arry = [];\r\n   \r\n    // loop through the questions, find post value by i and stored into object form then push to array\r\n    for (var i = 0; i < tempSurvey.shortAnswer1.length; i++) {\r\n        shorAns1Arry.push({ shrtAns1: req.body[i] })\r\n    }\r\n    for (var i = 0; i < tempSurvey.shortAnswer2.length; i++) {\r\n        shorAns2Arry.push({ shrtAns2: req.body[i] })\r\n    }\r\n    for (var i = 0; i < tempSurvey.shortAnswer3.length; i++) {\r\n        shorAns3Arry.push({ shrtAns3: req.body[i] })\r\n    }\r\n    for (var i = 0; i < tempSurvey.shortAnswer4.length; i++) {\r\n        shorAns4Arry.push({ shrtAns3: req.body[i] })\r\n    }\r\n    for (var i = 0; i < tempSurvey.shortAnswer5.length; i++) {\r\n        shorAns4Arry.push({ shrtAns4: req.body[i] })\r\n    }\r\n\r\n    // store object into db\r\n    SurveyAnswer.create({\r\n        surveyId: req.params.id,\r\n        shortAnswer1: shorAns1Arry,\r\n        shortAnswer2: shorAns2Arry,\r\n        shortAnswer3: shorAns3Arry,\r\n        shortAnswer4: shorAns4Arry,\r\n        shortAnswer5: shorAns5Arry,\r\n        submitted_at: Date.now()\r\n    }, function(err, Survey) {\r\n        if (err) {\r\n            console.log(err);\r\n            res.end(err);\r\n        }\r\n        else {\r\n            res.redirect('/');//after submission\r\n        }\r\n    });\r\n });\r\n  \r\n\r\n\r\n router.get('/takeSurvey/cancel/:id', function (req, res, next) {\r\n     res.render('index', {\r\n         title: 'MS Survey',\r\n         displayName: req.user ? req.user.displayName : '',\r\n         surveys: tempSurveys\r\n     });    \r\n });\r\n\r\n\r\n/* GET survey list page. */\r\nrouter.get('/listSurvey', requireAuth, (req: express.Request, res: express.Response, next: any) => {\r\n  res.render('surveys/index.ejs', { \r\n      title: 'My Survey List',\r\n      displayName: req.user ? req.user.displayName : '',\r\n      username: req.user ? req.user.username : '' \r\n  });\r\n});\r\n/*  */\r\nrouter.get('/listSurvey/create', requireAuth, (req: express.Request, res: express.Response, next: any) => {\r\n    res.render('surveys/index.ejs', {\r\n        title: 'My Survey List',\r\n        displayName: req.user ? req.user.displayName : '',\r\n        username: req.user ? req.user.username : ''\r\n    });\r\n});\r\n/* Render Login page. */\r\nrouter.get('/login', function (req, res, next) {\r\n    if (!req.user) {\r\n        res.render('login', {\r\n            title: 'Login',\r\n            messages: req.flash('loginMessage'),\r\n            displayName: req.user ? req.user.displayName : ''\r\n        });\r\n    }\r\n    else {\r\n        return res.redirect('/listSurvey')//redirect to listsurvey if logged in\r\n    }\r\n});\r\n\r\n\r\n\r\nmodule.exports = router;\r\n"],"sourceRoot":"/source/"}